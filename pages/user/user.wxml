<!--pages/user/user.wxml-->
<view class="container">
  <!-- ç”¨æˆ·å¤´åƒå’Œä¿¡æ¯ -->
  <view class="user-header">
    <view class="avatar-container">
      <image class="avatar" src="{{userInfo.avatarUrl || '/static/images/default-avatar.png'}}"></image>
    </view>
    <view class="user-basic-info">
      <view class="username">{{userInfo.nickName || userInfo.name || 'ç”¨æˆ·'}}</view>
      <view class="user-role">{{isAdmin ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}}</view>
    </view>
  </view>
  
  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tabs">
    <view 
      wx:for="{{tabs}}" 
      wx:key="index" 
      wx:if="{{index !== 2 || isAdmin}}" 
      class="tab-item {{activeTab === index ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-index="{{index}}"
    >
      {{item}}
    </view>
  </view>
  
  <!-- æ ‡ç­¾é¡µå†…å®¹ -->
  <view class="tab-content">
    <!-- æˆ‘çš„é¢„è®¢ -->
    <view class="reserve-list" wx:if="{{activeTab === 0}}">

      <block wx:if="{{reservations.length > 0}}">
        <view class="reserve-item" wx:for="{{reservations}}" wx:key="_id">
          <view class="reserve-header">
            <view class="seat-number">{{item.seatNumber}}</view>
            <view class="reserve-status {{item.status}}">{{item.statusText}}</view>
          </view>
          <view class="reserve-info">
            <view class="info-row">
              <text class="label">å¼€å§‹æ—¥æœŸï¼š</text>
              <text class="value">{{item.startDate}}</text>
            </view>
            <view class="info-row">
              <text class="label">ç»“æŸæ—¥æœŸï¼š</text>
              <text class="value">{{item.endDate}}</text>
            </view>
            <view class="info-row">
              <text class="label">å§“åï¼š</text>
              <text class="value">{{item.name || item.userName || userInfo.name || userInfo.nickName || 'æœªè®¾ç½®'}}</text>
            </view>
            <view class="info-row">
              <text class="label">æ‰‹æœºï¼š</text>
              <text class="value">{{item.userPhone || userInfo.phone || 'æœªè®¾ç½®'}}</text>
            </view>
            <view class="info-row">
              <text class="label">å¤‡æ³¨ï¼š</text>
              <text class="value">{{item.remark}}</text>
            </view>
          </view>
          <view class="reserve-actions">
            <button class="btn-cancel btn" bindtap="cancelReserve" data-id="{{item._id}}" wx:if="{{item.status === 'pending' }}">å–æ¶ˆé¢„è®¢</button>
          </view>
        </view>
      </block>
      <view class="no-data" wx:else>
        <text>æš‚æ— é¢„è®¢è®°å½•</text>
      </view>
    </view>
    
    <!-- ä¸ªäººä¿¡æ¯ -->
    <view class="user-profile" wx:if="{{activeTab === 1}}">
      <view class="section-title">ä¸ªäººä¿¡æ¯</view>
      <view class="profile-card">
        <view class="profile-item">
          <text class="label">å§“åï¼š</text>
          <text class="value">{{userInfo.name || userInfo.nickName || 'æœªè®¾ç½®'}}</text>
        </view>
        <view class="profile-item">
          <text class="label">æ‰‹æœºï¼š</text>
          <text class="value">{{userInfo.phone || 'æœªè®¾ç½®'}}</text>
        </view>
      </view>
      
      <view class="action-buttons">
        <button class="btn-primary btn" bindtap="editUserInfo">ä¿®æ”¹ä¿¡æ¯</button>
        <button class="btn-logout btn" bindtap="logout">é€€å‡ºç™»å½•</button>
      </view>
    </view>
    
    <!-- ç®¡ç†åå° -->
    <view class="admin-panel" wx:if="{{activeTab === 2 && isAdmin}}">
      <view class="section-title">ç®¡ç†åå°</view>
      <view class="admin-options">
        <view class="admin-option-item" bindtap="navigateToReservationReview">
          <view class="option-icon">ğŸ“‹</view>
          <view class="option-text">é¢„è®¢å®¡æ ¸</view>
        </view>
        <view class="admin-option-item" bindtap="navigateToNoticeManage">
          <view class="option-icon">ğŸ“¢</view>
          <view class="option-text">é€šçŸ¥ç®¡ç†</view>
        </view>
        <view class="admin-option-item" bindtap="showUserManagement">
          <view class="option-icon">ğŸ‘¥</view>
          <view class="option-text">ç”¨æˆ·ç®¡ç†</view>
        </view>
      </view>
      
      <!-- ç”¨æˆ·ç®¡ç†åŠŸèƒ½å·²ç§»è‡³ç‹¬ç«‹é¡µé¢ -->
    </view>
  </view>
</view>